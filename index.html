<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="theme-color" content="#4f46e5">
    
    <!-- SEO Meta Tags -->
    <title>Offerte.app - Motore di Ricerca Sconti e Codici Promozionali</title>
    <meta name="description" content="Cerca e confronta migliaia di offerte, errori di prezzo e codici sconto in tempo reale. Il motore di ricerca per il risparmio intelligente.">
    <meta name="keywords" content="motore ricerca offerte, comparatore prezzi, codici sconto, black friday, sconti amazon, errori prezzo">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://offerte.app/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://offerte.app/">
    <meta property="og:title" content="Offerte.app - Cerca, Trova, Risparmia">
    <meta property="og:description" content="Il motore di ricerca per scovare le migliori offerte del web in tempo reale.">
    <meta property="og:image" content="https://placehold.co/1200x630/4f46e5/ffffff?text=Offerte.app+Web">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Schema.org SearchAction -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "url": "https://offerte.app/",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://offerte.app/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Hide scrollbar for horizontal scrolling */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* --- ANIMAZIONI --- */
        
        /* Entrata dal basso fluida */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Pulsazione per badge HOT */
        @keyframes pulse-red {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Effetto POP per i bottoni */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        /* Loader */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Classi di utilitÃ  per animazioni */
        .animate-fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0; /* Inizia invisibile */
        }

        .animate-pulse-badge {
            animation: pulse-red 2s infinite;
        }

        .pop-active {
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .deal-card { 
            transition: transform 0.3s ease, box-shadow 0.3s ease; 
        }
        .deal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* PWA styles */
        .bottom-nav-padding { padding-bottom: 80px; }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #4f46e5;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen selection:bg-indigo-100 selection:text-indigo-800">

    <!-- Top App Bar (Sticky) -->
    <header class="fixed w-full z-40 bg-white/95 backdrop-blur-md shadow-sm border-b border-gray-100 top-0 transition-all duration-300">
        <div class="container mx-auto px-4 lg:px-8 h-16 flex items-center justify-between gap-4">
            <!-- Logo Fun & Modern -->
            <a href="#" class="flex-shrink-0 flex items-center group" onclick="resetFilters()">
                <div class="bg-gradient-to-br from-indigo-600 to-purple-600 text-white p-2 rounded-xl mr-2 shadow-lg group-hover:rotate-12 transition-transform duration-300">
                    <i class="fas fa-bolt text-lg"></i>
                </div>
                <div class="flex flex-col">
                    <span class="text-xl font-black text-gray-900 tracking-tight leading-none">Offerte<span class="text-indigo-600">.app</span></span>
                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest hidden sm:block">Risparmio Smart</span>
                </div>
            </a>

            <!-- Search Bar (Central & Dominant) -->
            <div class="flex-1 max-w-2xl relative group">
                <div class="relative transition-transform duration-300 focus-within:scale-[1.01]">
                    <input type="text" id="searchInput" placeholder="Cerca offerte (es. iPhone, Nike, TV...)" 
                           class="w-full bg-gray-100/80 hover:bg-white text-gray-900 border-2 border-transparent focus:border-indigo-500 rounded-2xl py-2.5 pl-11 pr-10 focus:ring-4 focus:ring-indigo-100 focus:bg-white transition-all shadow-inner text-sm sm:text-base font-medium placeholder-gray-400">
                    <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400 group-focus-within:text-indigo-500 transition-colors"></i>
                    </div>
                    <!-- Loader / Clear Icon -->
                    <div id="searchLoader" class="absolute inset-y-0 right-0 pr-3 flex items-center hidden">
                        <div class="loader"></div>
                    </div>
                     <div id="searchClear" class="absolute inset-y-0 right-0 pr-3 flex items-center hidden cursor-pointer text-gray-400 hover:text-red-500 transition-colors transform hover:rotate-90 duration-200" onclick="resetFilters()">
                        <i class="fas fa-times-circle text-lg"></i>
                    </div>
                </div>
            </div>

            <!-- User Actions (Desktop - No Login, Just Tools) -->
            <div class="flex items-center gap-3 sm:gap-4 flex-shrink-0">
                <button class="w-10 h-10 rounded-full bg-gray-50 hover:bg-indigo-50 text-gray-500 hover:text-indigo-600 transition flex items-center justify-center relative group">
                    <i class="far fa-bell text-xl group-hover:animate-bounce"></i>
                    <span class="absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white animate-pulse"></span>
                </button>
                
                <!-- Telegram CTA button instead of Login -->
                <a href="#" class="hidden sm:flex items-center gap-2 bg-[#0088cc] hover:bg-[#0077b5] text-white px-4 py-2 rounded-xl font-bold text-sm transition shadow-lg hover:shadow-cyan-500/30 transform hover:-translate-y-0.5">
                    <i class="fab fa-telegram-plane text-lg"></i>
                    <span>Canale VIP</span>
                </a>
            </div>
        </div>
        
        <!-- Mobile Categories (Horizontal Scroll) -->
        <div class="lg:hidden border-t border-gray-100 bg-white/95 backdrop-blur">
            <div class="flex overflow-x-auto gap-2 px-4 py-3 scrollbar-hide" id="mobileCategories">
                <!-- Categories injected by JS -->
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="flex flex-1 pt-[120px] lg:pt-[90px] bottom-nav-padding container mx-auto px-4 lg:px-8 gap-8">
        
        <!-- Sidebar Filters (Desktop Only) -->
        <aside class="hidden lg:block w-64 flex-shrink-0 fixed h-[calc(100vh-90px)] overflow-y-auto pb-10 pr-4 scrollbar-hide">
            <div class="space-y-8">
                <!-- Categories -->
                <div>
                    <h3 class="font-bold text-gray-900 mb-4 px-2 flex items-center gap-2">
                        <i class="fas fa-layer-group text-indigo-500"></i> Categorie
                    </h3>
                    <nav class="space-y-1" id="desktopCategories">
                        <!-- Injected by JS -->
                    </nav>
                </div>

                <!-- Stores -->
                <div>
                    <h3 class="font-bold text-gray-900 mb-4 px-2 flex items-center gap-2">
                        <i class="fas fa-store text-indigo-500"></i> Negozi Top
                    </h3>
                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 space-y-3">
                        <label class="flex items-center gap-3 cursor-pointer group">
                            <div class="w-5 h-5 rounded border border-gray-300 flex items-center justify-center text-white bg-white group-hover:border-indigo-500 transition-colors">
                                <input type="checkbox" class="hidden peer">
                                <i class="fas fa-check text-[10px] text-indigo-600 opacity-0 peer-checked:opacity-100"></i>
                            </div>
                            <span class="text-sm font-medium text-gray-600 group-hover:text-indigo-600 transition-colors">Amazon Prime</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                             <div class="w-5 h-5 rounded border border-gray-300 flex items-center justify-center text-white bg-white group-hover:border-indigo-500 transition-colors">
                                <input type="checkbox" class="hidden peer">
                                <i class="fas fa-check text-[10px] text-indigo-600 opacity-0 peer-checked:opacity-100"></i>
                            </div>
                            <span class="text-sm font-medium text-gray-600 group-hover:text-indigo-600 transition-colors">eBay Imperdibili</span>
                        </label>
                        <label class="flex items-center gap-3 cursor-pointer group">
                             <div class="w-5 h-5 rounded border border-gray-300 flex items-center justify-center text-white bg-white group-hover:border-indigo-500 transition-colors">
                                <input type="checkbox" class="hidden peer">
                                <i class="fas fa-check text-[10px] text-indigo-600 opacity-0 peer-checked:opacity-100"></i>
                            </div>
                            <span class="text-sm font-medium text-gray-600 group-hover:text-indigo-600 transition-colors">Unieuro / MediaWorld</span>
                        </label>
                    </div>
                </div>

                <!-- Promo Banner Sidebar -->
                <div class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-2xl p-5 text-white text-center shadow-lg relative overflow-hidden group">
                    <div class="absolute top-0 right-0 -mr-8 -mt-8 w-24 h-24 bg-white opacity-10 rounded-full group-hover:scale-150 transition-transform duration-700"></div>
                    <i class="fab fa-telegram-plane text-4xl mb-3 drop-shadow-md transform group-hover:-rotate-12 transition-transform"></i>
                    <p class="font-bold text-lg mb-1">Non perdere i bug!</p>
                    <p class="text-xs text-indigo-100 mb-4 opacity-90">Unisciti a 50.000+ risparmiatori su Telegram.</p>
                    <button class="w-full bg-white text-indigo-700 text-sm font-bold py-2.5 rounded-xl shadow-md hover:bg-gray-50 transition active:scale-95">Apri Canale</button>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 lg:ml-72 min-w-0 pb-12">
            
            <!-- Quick Stats / Breadcrumb -->
            <div class="flex items-end justify-between mb-8">
                <div>
                    <h1 class="text-2xl lg:text-3xl font-black text-gray-900 tracking-tight" id="pageTitle">In Vetrina ðŸ”¥</h1>
                    <p class="text-gray-500 text-sm mt-1">Le migliori occasioni selezionate in tempo reale.</p>
                </div>
                <div class="hidden sm:flex items-center gap-2 text-sm">
                    <div class="px-3 py-1.5 bg-white border border-gray-200 rounded-lg text-gray-600 font-medium shadow-sm flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span id="resultsCount">9</span> Offerte Live
                    </div>
                </div>
            </div>

            <!-- Active Filters (Dynamic) -->
            <div class="flex flex-wrap gap-2 mb-6 hidden animate-fade-in-up" id="activeFilters">
                <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-bold flex items-center gap-2 shadow-sm">
                    Elettronica <i class="fas fa-times cursor-pointer hover:text-indigo-900 bg-indigo-200 w-4 h-4 flex items-center justify-center rounded-full" onclick="resetFilters()"></i>
                </span>
            </div>

            <!-- Offers Grid -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6" id="dealsGrid">
                <!-- Deals will be populated by JS to simulate dynamic app feel -->
            </div>

            <!-- Empty State (Hidden by default) -->
            <div id="noResults" class="hidden text-center py-20 animate-fade-in-up">
                <div class="inline-flex items-center justify-center w-24 h-24 bg-gray-100 rounded-full mb-6 relative">
                    <i class="fas fa-search text-4xl text-gray-300"></i>
                    <i class="fas fa-question absolute top-6 right-6 text-xl text-indigo-400 animate-bounce"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Ops! Niente qui.</h3>
                <p class="text-gray-500 max-w-md mx-auto mb-6">Non abbiamo trovato offerte per questa ricerca. Riprova con parole chiave piÃ¹ generiche.</p>
                <button onclick="resetFilters()" class="bg-indigo-600 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-indigo-700 transition shadow-lg shadow-indigo-200">Torna alla Home</button>
            </div>
            
            <!-- Load More -->
            <div class="mt-12 text-center" id="loadMoreBtnContainer">
                <button class="group bg-white border-2 border-gray-100 text-gray-700 px-8 py-3 rounded-2xl font-bold hover:border-indigo-500 hover:text-indigo-600 transition-all shadow-sm hover:shadow-md w-full sm:w-auto flex items-center justify-center gap-2 mx-auto">
                    <span>Carica altre offerte</span>
                    <i class="fas fa-arrow-down group-hover:translate-y-1 transition-transform"></i>
                </button>
            </div>
        </main>
    </div>

    <!-- Mobile Bottom Navigation (App Like) -->
    <div class="lg:hidden fixed bottom-0 w-full bg-white/95 backdrop-blur-lg border-t border-gray-200 z-50 pb-safe shadow-[0_-5px_10px_rgba(0,0,0,0.02)]">
        <div class="flex justify-around items-center h-16 px-2">
            <a href="#" class="flex flex-col items-center justify-center w-full h-full text-indigo-600 group" onclick="resetFilters()">
                <div class="p-1 rounded-full group-hover:bg-indigo-50 transition-colors">
                    <i class="fas fa-home text-xl mb-0.5 transform group-active:scale-90 transition-transform"></i>
                </div>
                <span class="text-[10px] font-bold">Home</span>
            </a>
            <a href="#" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-indigo-500 group">
                <div class="p-1 rounded-full group-hover:bg-indigo-50 transition-colors">
                    <i class="fas fa-fire text-xl mb-0.5 transform group-active:scale-90 transition-transform"></i>
                </div>
                <span class="text-[10px] font-medium">Top</span>
            </a>
            <div class="relative -top-6">
                <button class="w-14 h-14 bg-gradient-to-tr from-indigo-600 to-purple-600 rounded-2xl text-white shadow-xl flex items-center justify-center text-xl hover:shadow-indigo-500/40 transition transform active:scale-95 rotate-45 group" onclick="document.getElementById('searchInput').focus()">
                    <i class="fas fa-search -rotate-45 group-hover:scale-110 transition-transform"></i>
                </button>
            </div>
            <a href="#" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-indigo-500 group">
                <div class="p-1 rounded-full group-hover:bg-indigo-50 transition-colors">
                    <i class="fab fa-telegram-plane text-xl mb-0.5 transform group-active:scale-90 transition-transform"></i>
                </div>
                <span class="text-[10px] font-medium">Canale</span>
            </a>
            <a href="#" class="flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-indigo-500 group">
                <div class="p-1 rounded-full group-hover:bg-indigo-50 transition-colors">
                    <i class="far fa-heart text-xl mb-0.5 transform group-active:scale-90 transition-transform"></i>
                </div>
                <span class="text-[10px] font-medium">Salvati</span>
            </a>
        </div>
    </div>

    <!-- JavaScript Data & Logic -->
    <script>
        // --- DATA LAYER ---
        const categories = [
            { id: 'all', name: 'Tutte', icon: 'fas fa-th-large' },
            { id: 'tech', name: 'Tech', icon: 'fas fa-mobile-alt' },
            { id: 'home', name: 'Casa', icon: 'fas fa-couch' },
            { id: 'fashion', name: 'Moda', icon: 'fas fa-tshirt' },
            { id: 'gaming', name: 'Game', icon: 'fas fa-gamepad' },
            { id: 'beauty', name: 'Beauty', icon: 'fas fa-spa' },
            { id: 'coupons', name: 'Coupon', icon: 'fas fa-ticket-alt' }
        ];

        // "Featured" Deals (Static Database)
        const staticDeals = [
            {
                id: 1,
                title: 'Apple AirPods Pro (2Âª gen) USB-C',
                price: 239.00,
                originalPrice: 279.00,
                discount: 15,
                store: 'Amazon',
                image: 'https://images.unsplash.com/photo-1603351154351-5cf99703f6a8?auto=format&fit=crop&w=500&q=80',
                category: 'tech',
                hot: true,
                time: '2 min fa'
            },
            {
                id: 2,
                title: 'PlayStation 5 Slim - Standard Edition',
                price: 449.99,
                originalPrice: 549.99,
                discount: 18,
                store: 'MediaWorld',
                image: 'https://images.unsplash.com/photo-1606813907291-d86efa9b94db?auto=format&fit=crop&w=500&q=80',
                category: 'gaming',
                hot: true,
                time: '15 min fa'
            },
            {
                id: 3,
                title: 'Dyson V15 Detect Absolute',
                price: 599.00,
                originalPrice: 799.00,
                discount: 25,
                store: 'Dyson IT',
                image: 'https://images.unsplash.com/photo-1558317374-a3594743e9c7?auto=format&fit=crop&w=500&q=80',
                category: 'home',
                hot: false,
                time: '1 ora fa'
            },
            {
                id: 4,
                title: 'Codice Sconto Nike Sito Ufficiale',
                price: 0,
                originalPrice: 0,
                discount: 25,
                store: 'Nike',
                image: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=500&q=80',
                category: 'coupons',
                code: 'JUSTDOIT25',
                hot: true,
                time: '3 ore fa'
            },
            {
                id: 5,
                title: 'Samsung Galaxy S24 Ultra 512GB',
                price: 1199.00,
                originalPrice: 1499.00,
                discount: 20,
                store: 'Samsung',
                image: 'https://images.unsplash.com/photo-1610945415295-d9bbf067e59c?auto=format&fit=crop&w=500&q=80',
                category: 'tech',
                hot: false,
                time: '4 ore fa'
            },
            {
                id: 6,
                title: 'Levi\'s 501 Original Fit Jeans',
                price: 65.50,
                originalPrice: 110.00,
                discount: 40,
                store: 'Zalando',
                image: 'https://images.unsplash.com/photo-1542272617-08f083157f5d?auto=format&fit=crop&w=500&q=80',
                category: 'fashion',
                hot: false,
                time: '5 ore fa'
            },
             {
                id: 7,
                title: 'MacBook Air M2 13" Galassia',
                price: 999.00,
                originalPrice: 1349.00,
                discount: 26,
                store: 'Amazon',
                image: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?auto=format&fit=crop&w=500&q=80',
                category: 'tech',
                hot: true,
                time: '6 ore fa'
            },
             {
                id: 8,
                title: 'Philips Hue White & Color Ambiance',
                price: 89.99,
                originalPrice: 149.99,
                discount: 40,
                store: 'Amazon',
                image: 'https://images.unsplash.com/photo-1558002038-1091a1661116?auto=format&fit=crop&w=500&q=80',
                category: 'home',
                hot: false,
                time: '7 ore fa'
            },
            {
                id: 9,
                title: 'Crema Viso Idratante CeraVe',
                price: 9.99,
                originalPrice: 16.50,
                discount: 39,
                store: 'Notino',
                image: 'https://images.unsplash.com/photo-1556228578-8d84487c6742?auto=format&fit=crop&w=500&q=80',
                category: 'beauty',
                hot: false,
                time: '8 ore fa'
            }
        ];

        let currentCategory = 'all';
        let searchTimeout = null;

        // --- CORE LOGIC ---

        function mockSearchAPI(query) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    if (!query) {
                        resolve(staticDeals);
                        return;
                    }

                    const q = query.toLowerCase();
                    const staticResults = staticDeals.filter(deal => 
                        deal.title.toLowerCase().includes(q) || 
                        deal.store.toLowerCase().includes(q)
                    );

                    let dynamicResults = [];
                    if (staticResults.length < 5) {
                        const stores = ['Amazon', 'eBay', 'Unieuro', 'MediaWorld', 'AliExpress'];
                        const bases = ['Pro', 'Max', 'Ultra', 'Lite', '2025 Edition', 'Bundle'];
                        const images = [
                            'https://images.unsplash.com/photo-1523275335684-37898b6baf30?auto=format&fit=crop&w=500&q=80', // Watch
                            'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=500&q=80', // Headphone
                            'https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?auto=format&fit=crop&w=500&q=80', // Camera
                            'https://images.unsplash.com/photo-1585336261022-680e295ce3fe?auto=format&fit=crop&w=500&q=80'  // Shoes
                        ];

                        const count = Math.floor(Math.random() * 3) + 4;
                        for(let i=0; i<count; i++) {
                            const originalPrice = Math.floor(Math.random() * 400) + 50;
                            const discount = Math.floor(Math.random() * 40) + 10;
                            const price = originalPrice - (originalPrice * (discount/100));
                            const randomStore = stores[Math.floor(Math.random() * stores.length)];
                            const randomBase = bases[Math.floor(Math.random() * bases.length)];
                            const randomImg = images[Math.floor(Math.random() * images.length)];
                            const titleQuery = q.charAt(0).toUpperCase() + q.slice(1);

                            dynamicResults.push({
                                id: 100 + i,
                                title: `${titleQuery} ${randomBase}`,
                                price: price,
                                originalPrice: originalPrice,
                                discount: discount,
                                store: randomStore,
                                image: randomImg,
                                category: 'generated',
                                hot: Math.random() > 0.7,
                                time: 'Appena trovato'
                            });
                        }
                    }
                    resolve([...staticResults, ...dynamicResults]);
                }, 800); 
            });
        }

        function renderCategories() {
            const desktopNav = document.getElementById('desktopCategories');
            const mobileNav = document.getElementById('mobileCategories');
            
            desktopNav.innerHTML = '';
            mobileNav.innerHTML = '';

            categories.forEach((cat, index) => {
                const isActive = cat.id === currentCategory;
                const activeClass = isActive 
                    ? 'bg-indigo-50 text-indigo-700 font-bold shadow-sm ring-1 ring-indigo-200' 
                    : 'text-gray-600 hover:bg-gray-50 hover:text-indigo-600';
                
                // Desktop
                desktopNav.innerHTML += `
                    <button onclick="filterCategory('${cat.id}')" class="w-full text-left flex items-center gap-3 px-3 py-3 rounded-xl transition-all duration-200 ${activeClass}">
                        <div class="w-8 h-8 rounded-lg flex items-center justify-center ${isActive ? 'bg-indigo-100 text-indigo-600' : 'bg-gray-100 text-gray-400 group-hover:bg-indigo-50'}">
                            <i class="${cat.icon} text-sm"></i>
                        </div>
                        <span class="text-sm">${cat.name}</span>
                        ${isActive ? '<i class="fas fa-chevron-right ml-auto text-xs text-indigo-400"></i>' : ''}
                    </button>
                `;

                // Mobile
                mobileNav.innerHTML += `
                    <button onclick="filterCategory('${cat.id}')" class="flex-shrink-0 px-5 py-2 rounded-full text-sm font-bold border transition-all duration-200 active:scale-95 ${isActive ? 'bg-indigo-600 text-white border-indigo-600 shadow-lg shadow-indigo-200' : 'bg-white text-gray-600 border-gray-200 shadow-sm'}">
                        ${cat.name}
                    </button>
                `;
            });
        }

        function renderDeals(dealsToRender) {
            const grid = document.getElementById('dealsGrid');
            const noResults = document.getElementById('noResults');
            const resultCount = document.getElementById('resultsCount');
            
            grid.innerHTML = '';
            resultCount.innerText = dealsToRender.length;
            
            if (dealsToRender.length === 0) {
                noResults.classList.remove('hidden');
                document.getElementById('loadMoreBtnContainer').classList.add('hidden');
            } else {
                noResults.classList.add('hidden');
                document.getElementById('loadMoreBtnContainer').classList.remove('hidden');
                
                dealsToRender.forEach((deal, index) => {
                    const isCoupon = deal.category === 'coupons';
                    const priceDisplay = isCoupon 
                        ? `<span class="text-indigo-600 font-bold bg-indigo-50 px-2 py-0.5 rounded text-sm">CODICE SCONTO</span>` 
                        : `<span class="text-gray-900 font-black text-xl tracking-tight">â‚¬${deal.price.toFixed(2)}</span>`;
                    
                    const originalPriceDisplay = (!isCoupon && deal.originalPrice > 0) 
                        ? `<span class="text-gray-400 line-through text-xs font-medium decoration-gray-300">â‚¬${deal.originalPrice.toFixed(2)}</span>` 
                        : '';

                    const badge = deal.hot 
                        ? `<span class="absolute top-3 right-3 bg-red-500 text-white text-[10px] font-black px-2.5 py-1 rounded-full shadow-lg shadow-red-200 flex items-center gap-1 z-10 animate-pulse-badge uppercase tracking-wider"><i class="fas fa-fire"></i> HOT</span>` 
                        : `<span class="absolute top-3 right-3 bg-white/95 backdrop-blur text-indigo-600 text-[10px] font-black px-2.5 py-1 rounded-full shadow-md z-10 border border-gray-100">-${deal.discount}%</span>`;

                    const actionButton = isCoupon 
                        ? `<button onclick="copyCoupon('${deal.code}', this)" class="w-full mt-4 bg-indigo-50 text-indigo-600 hover:bg-indigo-100 py-2.5 rounded-xl font-bold text-sm transition-all border border-indigo-200 border-dashed flex items-center justify-center gap-2 group/btn relative overflow-hidden">
                            <span class="z-10 flex items-center gap-2">${deal.code} <i class="far fa-copy"></i></span>
                           </button>`
                        : `<button class="w-full mt-4 bg-gray-900 text-white hover:bg-indigo-600 py-2.5 rounded-xl font-bold text-sm transition-all shadow-md hover:shadow-indigo-200 flex items-center justify-center gap-2 group/btn transform active:scale-95">
                            Vedi Offerta <i class="fas fa-arrow-right text-xs transition-transform group-hover/btn:translate-x-1"></i>
                           </button>`;

                    // Staggered Animation Delay
                    const delay = index * 70;

                    grid.innerHTML += `
                        <article class="deal-card bg-white rounded-2xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07)] border border-gray-100/50 overflow-hidden group flex flex-col h-full animate-fade-in-up" style="animation-delay: ${delay}ms">
                            <div class="relative h-48 overflow-hidden bg-gray-100">
                                <img src="${deal.image}" alt="${deal.title}" class="w-full h-full object-cover group-hover:scale-110 transition duration-700 ease-in-out">
                                ${badge}
                                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                <span class="absolute bottom-3 left-3 bg-black/70 backdrop-blur-md text-white text-[10px] font-bold px-2 py-1 rounded-md flex items-center gap-1.5 shadow-sm border border-white/10">
                                    <i class="fas fa-store text-gray-300"></i> ${deal.store}
                                </span>
                            </div>
                            <div class="p-5 flex flex-col flex-1 relative">
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider flex items-center gap-1">
                                        <i class="far fa-clock"></i> ${deal.time}
                                    </span>
                                </div>
                                <h3 class="font-bold text-gray-800 mb-2 leading-snug line-clamp-2 group-hover:text-indigo-600 transition-colors" title="${deal.title}">${deal.title}</h3>
                                <div class="mt-auto pt-3 border-t border-gray-50/50">
                                    <div class="flex justify-between items-end">
                                        <div class="flex flex-col">
                                            ${originalPriceDisplay}
                                            <div class="flex items-center gap-2 mt-0.5">
                                                ${priceDisplay}
                                            </div>
                                        </div>
                                    </div>
                                    ${actionButton}
                                </div>
                            </div>
                        </article>
                    `;
                });
            }
        }

        const searchInput = document.getElementById('searchInput');
        const searchLoader = document.getElementById('searchLoader');
        const searchClear = document.getElementById('searchClear');
        const pageTitle = document.getElementById('pageTitle');

        searchInput.addEventListener('input', (e) => {
            const term = e.target.value;
            if(term.length > 0) {
                searchClear.classList.remove('hidden');
                searchLoader.classList.remove('hidden');
                searchClear.classList.add('hidden'); 
            } else {
                resetFilters();
                return;
            }
            if (searchTimeout) clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                const results = await mockSearchAPI(term);
                renderDeals(results);
                searchLoader.classList.add('hidden');
                searchClear.classList.remove('hidden');
                pageTitle.innerText = `Risultati per "${term}"`;
                currentCategory = null;
                renderCategories();
            }, 600);
        });

        window.filterCategory = function(catId) {
            currentCategory = catId;
            searchInput.value = '';
            searchClear.classList.add('hidden');
            const filtered = catId === 'all' 
                ? staticDeals 
                : staticDeals.filter(deal => deal.category === catId);
            renderCategories();
            renderDeals(filtered);
            const catName = categories.find(c => c.id === catId).name;
            pageTitle.innerText = catId === 'all' ? 'In Vetrina ðŸ”¥' : catName;
        };

        window.resetFilters = function() {
            searchInput.value = '';
            searchClear.classList.add('hidden');
            searchLoader.classList.add('hidden');
            filterCategory('all');
        }

        window.copyCoupon = function(code, btn) {
            navigator.clipboard.writeText(code).then(() => {
                // Add pop animation class
                btn.classList.add('pop-active');
                
                const originalHtml = btn.innerHTML;
                const originalClasses = btn.className;
                
                // Success State
                btn.innerHTML = `<span class="flex items-center gap-2">COPIATO! ðŸŽ‰</span>`;
                btn.classList.remove('bg-indigo-50', 'text-indigo-600', 'border-indigo-200');
                btn.classList.add('bg-green-500', 'text-white', 'border-transparent', 'shadow-lg', 'shadow-green-200');
                
                setTimeout(() => {
                    btn.classList.remove('pop-active'); // Reset anim
                }, 300);

                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.className = originalClasses; // Restore original classes
                }, 2000);
            });
        }

        renderCategories();
        renderDeals(staticDeals);
    </script>
</body>
</html>
